<!DOCTYPE html>
<html>
<head>
<script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>

<body>
		<svg id="svg">
		</svg>
<script>
	function findClosest(num, arr) {
		// Finds the value closest to num in arr
		var currClosest = arr[0];
		var currDiff = Math.abs(num-currClosest);
		for(var i = 0; i < arr.length; i++) {
			if(Math.abs(arr[i]-num) < currDiff) {
				currDiff = Math.abs(arr[i]-num);
				currClosest = arr[i];
			}
		}
		return[currClosest, currDiff];
	}
	// Make the board 
	var svgns = "http://www.w3.org/2000/svg";
	var margin = 0.1;
	var marginW = 0.3;
	var verticalNicks = 13;
	var horizontalNicks = 5;

	var startingHeight = window.innerHeight * margin;
	var boardH = window.innerHeight - 2 * startingHeight;
	console.log(startingHeight);
	console.log(window.innerHeight);
	console.log(boardH);
	var distanceNicks = boardH/verticalNicks;

	var startingWidth = window.innerWidth * marginW;
	var boardW = window.innerWidth - 2 * startingWidth;
	var distanceNicksH = Math.floor(boardW/horizontalNicks);
	var circleRadius = Math.floor(distanceNicks/2.0) - 3;
	// console.log(document.body.scrollWidth);
	var svg = document.getElementById('svg');
	svg.setAttribute("width", window.innerWidth);
	svg.setAttribute("height", window.innerHeight);
	var safeZones = [];
	safeZones[0] = [startingHeight+distanceNicks];
	
	// Create circles, rectangles, lines
	var vertical_nicks = [];
	for(var i = 0; i < verticalNicks; i++) {
		// var line = document.createElementNS(svgns, 'line');
		// line.setAttributeNS(null, 'x1', startingWidth);
		// line.setAttributeNS(null, 'y1', startingHeight + i*distanceNicks);
		// line.setAttributeNS(null,'x2', startingWidth + (horizontalNicks-1)*distanceNicksH);
		// line.setAttributeNS(null, 'y2', startingHeight + i * distanceNicks);
		// line.setAttributeNS(null,'stroke', 'black');
		// document.getElementById('svg').appendChild(line);
		var path = document.createElementNS(svgns, 'path');
		var input = "M" + startingWidth + "," + (startingHeight + i * distanceNicks) + " L" + (startingWidth + (horizontalNicks-1)*distanceNicksH) + "," + (startingHeight + i * distanceNicks);
		path.setAttributeNS(null, "d", input);
		path.setAttribute("stroke", "black");
		svg.appendChild(path);
		vertical_nicks.push(startingHeight + i * distanceNicks);
	}
	var horizontal_nicks = [];
	for(var k = 0; k < horizontalNicks; k++) {
		// var line = document.createElementNS(svgns, 'line');
		// line.setAttributeNS(null, 'x1', startingWidth + k*distanceNicksH);
		// line.setAttributeNS(null, 'y1', startingHeight);
		// line.setAttributeNS(null, 'x2', startingWidth + k*distanceNicksH);
		// line.setAttributeNS(null, 'y2', startingHeight + (verticalNicks-1)*distanceNicks + circleRadius);
		// line.setAttributeNS(null,"stroke", "black")
		// line.setAttribute('class', 'vertical');
		// document.getElementById('svg').appendChild(line);
		var path = document.createElementNS(svgns, 'path');
		var input = "M" + (startingWidth + k * distanceNicksH) + "," + startingHeight + " L" + (startingWidth + k * distanceNicksH) + "," + (startingHeight + (verticalNicks-1)*distanceNicks);
		path.setAttributeNS(null, "d", input);
		path.setAttribute("stroke", "black");
		svg.appendChild(path);
		horizontal_nicks.push(startingWidth + k*distanceNicksH);
	}
	vertical_nicks.sort();
	horizontal_nicks.sort();

	for(var i = 0; i < verticalNicks; i++) {
		for(var k = 0; k < horizontalNicks; k++) {
			var circle = document.createElementNS(svgns, 'circle');
			circle.setAttributeNS(null, 'cx', startingWidth + k*distanceNicksH);
			circle.setAttributeNS(null, 'cy', startingHeight + i*distanceNicks);
			circle.setAttributeNS(null, 'r', circleRadius);
			circle.setAttribute("visibility", "hidden");
			circle.setAttribute("class", "hidden_circle");
			document.getElementById('svg').appendChild(circle);
			if(i >= 5 && i <= verticalNicks-6) {
				continue;
			}			
			if((i % 2 == 1 && k % 2 == 1) || (i == 2 && k == 2) || (i == verticalNicks-3 && k == horizontalNicks-3)) {
				var circle = document.createElementNS(svgns, 'circle');
				circle.setAttributeNS(null, 'cx', startingWidth + k*distanceNicksH);
				circle.setAttributeNS(null, 'cy', startingHeight + i*distanceNicks);
				circle.setAttributeNS(null, 'r', circleRadius);
				circle.style.fill = 'white';
				circle.style.stroke = "black";
				circle.style.strokeWidth = 1;
				document.getElementById('svg').appendChild(circle);

			}
			else {
				var rect = document.createElementNS(svgns, "rect");
				rect.setAttributeNS(null,'x',startingWidth+k*distanceNicksH - circleRadius*2);
				rect.setAttributeNS(null, 'y', startingHeight + i*distanceNicks - circleRadius);
				rect.setAttributeNS(null, 'height', circleRadius*2);
				rect.setAttributeNS(null,'width', circleRadius*4);
				rect.style.fill = "white";
				rect.style.stroke = 'black';
				rect.style.strokeWidth = 1;
				document.getElementById('svg').appendChild(rect);
			}
		}
	}

	var circle = document.createElementNS(svgns,'circle');
	circle.setAttributeNS(null, 'cx', startingWidth);
	circle.setAttributeNS(null, 'cy', startingHeight);
	circle.setAttributeNS(null, 'r', circleRadius);
	circle.setAttributeNS(null,"id", "c");
	circle.onclick = function(e) {
		e.stopImmediatePropagation();
		this.setAttribute("class", "selected");
	}
	svg.appendChild(circle);
	svg.onclick = function() {
		console.log(event.clientX);
		console.log(event.clientY);
		var circle_arr = document.getElementsByClassName("selected");
		if(circle_arr.length == 0) {
			console.log("here3");
			return;
		}
		var circle = circle_arr[0];
		console.log(circle);
		var distance_x = event.clientX - circle.getAttribute("cx");
		var distance_y = event.clientX - circle.getAttribute("cy");
		var closest_x = findClosest(event.clientX, horizontal_nicks);
		var closest_y = findClosest(event.clientY, vertical_nicks);
		console.log(closest_x);
		console.log(closest_y);
		if(closest_x[1] > distanceNicksH || closest_y[1] > distanceNicks) {
			console.log("here");
			return;
		}
		if(closest_x[0] != circle.getAttribute("cx") && closest_y[0] != circle.getAttribute("cy")){
			console.log("here1");
			return;

		} 
		if(closest_x[0] == circle.getAttribute("cx")) {
			circle.setAttributeNS(null,"cy", closest_y[0]);
			console.log("hihi");

		}
		else {
			circle.setAttributeNS(null,"cx", closest_x[0]);
			console.log('heldsa');
		}
		circle.setAttribute("class", "not_selected");
	}




</script>
</body>


</html>

